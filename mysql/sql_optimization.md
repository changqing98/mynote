# SQL优化

本文主要讲述一些基本的SQL优化策略，并适当说明其缘由。

## 一、基本术语

-   全表扫描(索引未命中)

数据表没有索引或者数据库存储引擎没有使用索引，而遍历整张表进行某操作的情况，一般数据量大的表中进行全表扫描性能极差。

-   回表

由于非聚簇的叶子结点存储的并非完整的数据，而是聚餐索引的索引值，因此必须通过回表操作，查找对应的数据。

## 二、基本查询优化

### 1. 按需查询不要select*

-   仅查询所需的字段、尽可能使用覆盖索引（即待查询的所有字段都是索引字段）来避免回表操作。
-   按需查询，减少网络IO

### 2. 索引字段尽量设置不要为空，建议设置默认值等

-   至于网上说的null值查询不能使用索引其实是不正确的，正常情况下null值查询都是可以使用索引的，真正导致null值不走索引是由于null的数据行太多，需要太多的回表操作，存储引擎认为使用索引的时间大于全表扫描的时间，于是就放弃使用索引。

### 3. 判断是否存在不要Count 

```sql
select 1 from table_name where a = a and b = b limit 1;
```

**Do not**

```sql
select count(*) from table_name where a = a and b = b;
```

-   对于大表的count需求可以考虑提前计算好结果进行存储。

